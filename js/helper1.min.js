var colors=["#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c"];Chart.defaults.global.defaultFontFamily="Nunito",Chart.defaults.global.defaultFontColor="#858796",window.randomScalingFactor=function(){return Math.floor(100*Math.random())},window.chartColors={red:"rgb(255, 0, 0)",orange:"rgb(255, 165, 0)",yellow:"rgb(255, 205, 86)",green:"rgb(0, 128, 0)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"};var initializeMap=function(e){let o={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:e};var r=["<",["get","confirmed"],1e3],t=["all",[">=",["get","confirmed"],2],["<",["get","confirmed"],5e3]],a=["all",[">=",["get","confirmed"],3],["<",["get","confirmed"],1e4]],n=["all",[">=",["get","confirmed"],4],["<",["get","confirmed"],5e4]],c=[">=",["get","confirmed"],5e4];mapboxgl.accessToken="pk.eyJ1IjoiaWlhLXBsYW5ldCIsImEiOiJjazZrY3RyeWgwMzB0M2RxZmIwcnp0cXFhIn0.4KlBCBispcZFokPHivJZOQ";var i=new mapboxgl.Map({container:"map",zoom:3,center:[78,20],style:"mapbox://styles/mapbox/dark-v10"});i.addControl(new mapboxgl.NavigationControl),i.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),i.on("load",function(){i.addSource("corona_spots",{type:"geojson",data:o,cluster:!0,clusterRadius:1,clusterProperties:{sum:["+",["get","confirmed"]],confirmed1:["+",["case",r,1,0]],confirmed2:["+",["case",t,1,0]],confirmed3:["+",["case",a,1,0]],confirmed4:["+",["case",n,1,0]],confirmed5:["+",["case",c,1,0]]}}),i.addLayer({id:"corona_circle",type:"circle",source:"corona_spots",filter:["!=","cluster",!0],paint:{"circle-color":["case",r,colors[0],t,colors[1],a,colors[2],n,colors[3],colors[4]],"circle-opacity":1,"circle-radius":20}}),i.addLayer({id:"corona_label",type:"symbol",source:"corona_spots",filter:["!=","cluster",!0],layout:{"text-field":["number-format",["get","confirmed"],{"min-fraction-digits":0,"max-fraction-digits":0}],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","confirmed"],100],"black","black"]}});var e={},s={};function l(){for(var o={},r=i.querySourceFeatures("corona_spots"),t=0;t<r.length;t++){var a=r[t].geometry.coordinates,n=r[t].properties;if(n.cluster){var c=n.cluster_id,l=e[c];if(!l){var d=createDonutChart(n);l=e[c]=new mapboxgl.Marker({element:d}).setLngLat(a)}o[c]=l,s[c]||l.addTo(i)}}for(c in s)o[c]||s[c].remove();s=o}i.on("data",function(e){"corona_spots"===e.sourceId&&e.isSourceLoaded&&(i.on("move",l),i.on("moveend",l),l())})}),i.on("click","corona_circle",function(e){for(var o=e.features[0].geometry.coordinates.slice(),r="<br><p>Country:"+e.features[0].properties.country+"<br><p>Confirmed: "+e.features[0].properties.confirmed+"</p><p>Died: "+e.features[0].properties.died+"</p><p>Recovered: "+e.features[0].properties.recovered+"</p>";Math.abs(e.lngLat.lng-o[0])>180;)o[0]+=e.lngLat.lng>o[0]?360:-360;(new mapboxgl.Popup).setLngLat(o).setHTML(r).addTo(i)}),i.on("mouseenter","corona_circle",function(){i.getCanvas().style.cursor="pointer"}),i.on("mouseleave","corona_circle",function(){i.getCanvas().style.cursor=""})};function createDonutChart(e){for(var o=[],r=[e.confirmed1,e.confirmed2,e.confirmed3,e.confirmed4,e.confirmed5],t=0,a=0;a<r.length;a++)o.push(t),t+=r[a];var n=t>=1e3?22:t>=100?20:t>=10?18:16,c=e.sum>=1e3?50:e.sum>=100?32:e.sum>=10?24:18,i=Math.round(.88*c),s=2*c,l='<div><svg width="'+s+'" height="'+s+'" viewbox="0 0 '+s+" "+s+'" text-anchor="middle" style="font: '+n+'px sans-serif">';for(a=0;a<r.length;a++)l+=donutSegment(o[a]/t,(o[a]+r[a])/t,c,i,colors[a]);l+='<circle cx="'+c+'" cy="'+c+'" r="'+i+'" fill="white" /><text dominant-baseline="central" transform="translate('+c+", "+c+')">'+e.sum.toLocaleString()+"</text></svg></div>";var d=document.createElement("div");return d.innerHTML=l,d.firstChild}function donutSegment(e,o,r,t,a){o-e==1&&(o-=1e-5);var n=2*Math.PI*(e-.25),c=2*Math.PI*(o-.25),i=Math.cos(n),s=Math.sin(n),l=Math.cos(c),d=Math.sin(c),f=o-e>.5?1:0;return['<path d="M',r+t*i,r+t*s,"L",r+r*i,r+r*s,"A",r,r,0,f,1,r+r*l,r+r*d,"L",r+t*l,r+t*d,"A",t,t,0,f,0,r+t*i,r+t*s,'" fill="'+a+'" />'].join(" ")}